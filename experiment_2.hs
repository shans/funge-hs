import FungeBase
import RunFunge
import RandomFunge
import Control.Monad
import Data.Maybe
import Data.List

import Data.IORef
import System.Posix.Signals

run_1_core dim n p = doRandomFunge (runFor n) [dim] [0] [1] (defaultConfig { charSet = chars1D, trace = noTrace, acceptUserInput = False, activeExtensions = "" , printer = p })

run_2_core dim n p = doRandomFunge (runFor n) [dim, dim] [0, 0] [1, 0] (defaultConfig { charSet = chars2D, trace = noTrace, acceptUserInput = False, activeExtensions = "", printer = p })

run_3_core dim n p = doRandomFunge (runFor n) [dim, dim, dim] [0, 0, 0] [1, 0, 0] (defaultConfig { charSet = chars3D, trace = noTrace, acceptUserInput = False, activeExtensions = "", printer = p })

go core dim n runs = do
  currentProgram <- newIORef ""
  installHandler sigINT (CatchOnce (do { p <- readIORef currentProgram; putStrLn ("killed while executing " ++ p); raiseSignal sigINT})) Nothing  
  result <- sequence . map (\(a,b) -> do {putStrLn (show b) ; a}) $ zip (replicate runs $ core dim n (\a b -> writeIORef currentProgram (funge2DToString a b))) [0..(runs - 1)]
  let terminators = sort . map snd . catMaybes . map fst $ result
  let counts = map (\a -> (head a, length a)) . group $ terminators
  putStrLn "----"
  putStrLn ""
  sequence_ $ map (\(val, num) -> putStrLn (show val ++ ": " ++ show (fromIntegral num / fromIntegral runs * 100.0))) counts
  putStrLn ("~: " ++ show (fromIntegral (runs - length terminators) / fromIntegral runs * 100.0))


{-- 

main = go run_1_core 10 100 100000

1: 7.475
2: 2.675
3: 2.456
4: 1.822
5: 1.560
6: 1.281
7: 1.142
8: 0.889
9: 0.604
10: 0.367
11: 0.302
12: 0.206
13: 0.271
14: 0.215
15: 0.178
16: 0.145
17: 0.141
18: 0.103
19: 0.080
20: 0.035
21: 0.036
22: 0.017
23: 0.022
24: 0.019
25: 0.031
26: 0.028
27: 0.030
28: 0.030
29: 0.034
30: 0.030
31: 0.025
32: 0.025
33: 0.026
34: 0.018
35: 0.019
36: 0.014
37: 0.009
38: 0.004
39: 0.001
40: 0.009
41: 0.005
42: 0.005
43: 0.004
44: 0.004
45: 0.001
46: 0.003
47: 0.003
48: 0.003
49: 0.001
50: 0.001
51: 0.001
52: 0.002
53: 0.002
54: 0.001
55: 0.003
59: 0.001
60: 0.001
65: 0.001
66: 0.001
67: 0.002
69: 0.001
70: 0.001
71: 0.003
75: 0.001
79: 0.002
80: 0.001
83: 0.001
85: 0.001
87: 0.001
91: 0.001
93: 0.001
94: 0.001
98: 0.001
~: 77.565

--}

{--

main = go run_1_core 100 1000 100000


b1!%!7a,$<:4+x8[<f<ug+ 8d4drf#c675$#a30b2[gp ,c.q2ar*p21dk5ek4:d-6\"asg0gaj$k4\\j}85k6`k6%u%/}e-{{$$'c
 - woah. abs -2147483648 == -2147483648

?7 dj3j j\"ws-'\\,.k<@\"+]k2/6xb9!0[7\\-089q-s@+7q0[!>,]!u$,<;!1e3>686xx]%\"6 ,:1@eaj%*k@+wc8>8;xb14d!?$g
 - another missing cellToData.

1: 7.557
2: 2.635
3: 2.503
4: 1.935
5: 1.729
6: 1.371
7: 1.266
8: 1.004
9: 0.933
10: 0.758
11: 0.668
12: 0.582
13: 0.55
14: 0.46
15: 0.4
16: 0.355
17: 0.304
18: 0.293
19: 0.269
20: 0.2
21: 0.219
22: 0.199
23: 0.168
24: 0.144
25: 0.134
26: 0.155
27: 0.111
28: 0.119
29: 0.119
30: 0.114
31: 0.091
32: 0.103
33: 0.069
34: 0.078
35: 0.086
36: 0.074
37: 0.084
38: 0.068
39: 0.054
40: 0.050
41: 0.059
42: 0.048
43: 0.037
44: 0.054
45: 0.050
46: 0.046
47: 0.043
48: 0.052
49: 0.038
50: 0.042
51: 0.046
52: 0.046
53: 0.045
54: 0.059
55: 0.048
56: 0.041
57: 0.042
58: 0.037
59: 0.035
60: 0.037
61: 0.038
62: 0.025
63: 0.039
64: 0.038
65: 0.030
66: 0.029
67: 0.028
68: 0.031
69: 0.033
70: 0.040
71: 0.028
72: 0.021
73: 0.031
74: 0.032
75: 0.026
76: 0.025
77: 0.030
78: 0.029
79: 0.020
80: 0.020
81: 0.030
82: 0.028
83: 0.017
84: 0.024
85: 0.021
86: 0.020
87: 0.036
88: 0.028
89: 0.020
90: 0.024
91: 0.016
92: 0.026
93: 0.018
94: 0.013
95: 0.021
96: 0.015
97: 0.022
98: 0.019
99: 0.018
100: 0.016
101: 0.018
102: 0.027
103: 0.033
104: 0.039
105: 0.039
106: 0.035
107: 0.034
108: 0.031
109: 0.037
110: 0.025
111: 0.018
112: 0.032
113: 0.024
114: 0.028
115: 0.021
116: 0.023
117: 0.029
118: 0.021
119: 0.020
120: 0.022
121: 0.017
122: 0.021
123: 0.016
124: 0.010
125: 0.011
126: 0.019
127: 0.005
128: 0.010
129: 0.012
130: 0.009
131: 0.009
132: 0.003
133: 0.011
134: 0.011
135: 0.006
136: 0.009
137: 0.008
138: 0.006
139: 0.007
140: 0.011
141: 0.006
142: 0.004
143: 0.007
144: 0.011
145: 0.006
146: 0.002
147: 0.006
148: 0.010
149: 0.004
150: 0.001
151: 0.005
152: 0.002
153: 0.004
154: 0.004
155: 0.001
156: 0.007
157: 0.006
158: 0.004
159: 0.006
160: 0.003
161: 0.002
162: 0.005
163: 0.003
164: 0.004
165: 0.001
167: 0.007
168: 0.005
169: 0.004
170: 0.003
171: 0.003
172: 0.007
173: 0.002
174: 0.006
175: 0.003
176: 0.004
177: 0.003
178: 0.004
179: 0.005
180: 0.005
181: 0.002
182: 0.001
183: 0.005
184: 0.002
185: 0.001
186: 0.003
188: 0.005
190: 0.004
191: 0.001
193: 0.004
194: 0.002
196: 0.002
197: 0.004
198: 0.005
199: 0.001
200: 0.002
201: 0.001
202: 0.002
203: 0.004
205: 0.003
206: 0.006
207: 0.007
208: 0.008
209: 0.006
210: 0.011
211: 0.013
212: 0.006
213: 0.007
214: 0.005
215: 0.014
216: 0.008
217: 0.006
218: 0.005
219: 0.008
220: 0.006
221: 0.005
222: 0.004
223: 0.005
224: 0.003
225: 0.008
226: 0.005
227: 0.003
228: 0.006
229: 0.008
230: 0.004
231: 0.002
233: 0.001
234: 0.005
236: 0.001
237: 0.003
238: 0.005
239: 0.003
240: 0.003
241: 0.002
242: 0.003
243: 0.001
244: 0.002
245: 0.003
246: 0.001
248: 0.002
249: 0.001
251: 0.001
253: 0.001
254: 0.001
255: 0.001
256: 0.001
257: 0.001
261: 0.001
265: 0.003
266: 0.003
267: 0.001
277: 0.001
278: 0.001
280: 0.002
282: 0.001
284: 0.002
291: 0.001
293: 0.001
294: 0.001
298: 0.001
303: 0.001
305: 0.001
307: 0.001
310: 0.001
313: 0.001
314: 0.002
315: 0.002
320: 0.001
322: 0.002
323: 0.001
324: 0.001
326: 0.001
332: 0.001
334: 0.003
336: 0.001
337: 0.001
343: 0.001
349: 0.002
351: 0.001
352: 0.001
354: 0.003
355: 0.001
356: 0.001
357: 0.001
362: 0.001
364: 0.001
366: 0.001
370: 0.002
371: 0.001
373: 0.001
381: 0.001
383: 0.001
392: 0.001
395: 0.002
396: 0.001
397: 0.001
401: 0.001
402: 0.001
403: 0.001
415: 0.001
416: 0.001
432: 0.001
433: 0.001
434: 0.001
445: 0.001
449: 0.001
451: 0.001
453: 0.001
455: 0.001
456: 0.001
457: 0.001
462: 0.001
465: 0.001
472: 0.001
473: 0.001
483: 0.001
489: 0.001
500: 0.001
508: 0.001
525: 0.001
526: 0.001
528: 0.001
529: 0.001
536: 0.002
538: 0.001
540: 0.001
550: 0.001
553: 0.001
561: 0.001
562: 0.001
567: 0.001
589: 0.001
594: 0.001
621: 0.001
622: 0.001
630: 0.001
632: 0.001
633: 0.001
640: 0.001
691: 0.001
708: 0.001
713: 0.001
720: 0.001
742: 0.002
755: 0.001
763: 0.001
823: 0.001
865: 0.001
934: 0.001
937: 0.001
965: 0.001
~: 68.73

--}

{--

main = go run_1_core 1000 1000 100000

*wxr2wn\"%/2+4/\\p g :p72.p]#ga40*k46,'u_rxb3@d??\\[]58e*g?u9jfa3>\\5r7>p5?<! 8$x?9u8{*.ns\\f`]$@ru{]\"*\"b6.5,}!p{qq-{'#+,%u5\"\"+[3w2[ n{{wqfj3-66{s1 ?*+06$ab`,3_g6.[b0,]j6g\"u1g}}gu: \\f{0$#50x,:9j2}{>as0e,}d e`1 g7eas+\"6[-3320s7w5k7f\"\\:,<92?f[%s9%\\4;0178f9,/wcgdwu9pu. agr[s@[bjp9}k<\"d!+5{pqu:5 unjg,-%-$2}$/n_w34w.[*<5#g7} @q4-pe@an+4346[!<:0[k14fg4''%,]}']}+b!f4r\\kn6fx6rr]`r3]c9aj-/3*n//dupf#\\/7w-#;j.+!.?`-0s]<wf#6k}c[>;#`1;9\\j\\;q$$\\1j,w!_jrrkr:@'!\\na*]1-pss]%:>5xw$;cdp3xapga@4w?dp-[2\"6sgsd8{?\\`se1]#r8g8c:\\>?8'5p89\\k4_w.':0`6+r./aj-_fr+*n8g6gn,[j;w@f!;r .[f\\_\"cgss1@g42#,u$>%a$fx2+r!b7{$]ugn;rk#c#`%s__8:?+x#5!w%#`1.d-2\"bu?asf3'1a]'/#[{{1{\">bg!\"#$wu0,\\[[;%' 5*\"7$?3[d901!>%,/!5%d4e!%3s9f9n!>snbn,]?_a;c3prx[`%.6-<a'@wdc\\%\"dw;q8]:,<$$>e0{j6a2-#<\"0[b4r.+bf0n5:pn{4{#6-f$sr}g05[?j$j;9//>p-.'bb1,><[2nn1'df<@fg:'pg2pr[g[]}\\\"!2<8gdqpj$! 41a-?e\\%?q0?kc$623q0<jc2]:$$71r;c/\\+\\}+]e0pp-r 7 **n2}]j@.x\".+``n4-#.n;- #sb84\"+</<].2[{u@'@}-6d.s5f\"df%b'92s :,:{#%k_f0wjs6\\}3e>'_>a`/$p\\#b$8#xb.9*1fx{aa:$ee,,{4'3d\"%#j

1: 7.378
2: 2.763
3: 2.488
4: 1.941
5: 1.743
6: 1.46
7: 1.266
8: 1.017
9: 0.985
10: 0.777
11: 0.741
12: 0.624
13: 0.523
14: 0.498
15: 0.442
16: 0.355
17: 0.345
18: 0.307
19: 0.305
20: 0.269
21: 0.234
22: 0.205
23: 0.183
24: 0.171
25: 0.186
26: 0.140
27: 0.146
28: 0.111
29: 0.114
30: 0.147
31: 0.105
32: 0.091
33: 0.091
34: 0.088
35: 0.104
36: 0.064
37: 0.070
38: 0.075
39: 0.078
40: 0.067
41: 0.077
42: 0.086
43: 0.055
44: 0.069
45: 0.051
46: 0.054
47: 0.050
48: 0.043
49: 0.049
50: 0.049
51: 0.055
52: 0.036
53: 0.048
54: 0.046
55: 0.042
56: 0.041
57: 0.050
58: 0.027
59: 0.044
60: 0.049
61: 0.043
62: 0.046
63: 0.037
64: 0.039
65: 0.042
66: 0.036
67: 0.031
68: 0.037
69: 0.039
70: 0.035
71: 0.036
72: 0.045
73: 0.024
74: 0.031
75: 0.031
76: 0.029
77: 0.032
78: 0.027
79: 0.026
80: 0.023
81: 0.036
82: 0.035
83: 0.024
84: 0.022
85: 0.034
86: 0.025
87: 0.028
88: 0.019
89: 0.033
90: 0.024
91: 0.023
92: 0.021
93: 0.028
94: 0.027
95: 0.027
96: 0.031
97: 0.025
98: 0.028
99: 0.015
100: 0.013
101: 0.024
102: 0.019
103: 0.023
104: 0.027
105: 0.029
106: 0.018
107: 0.018
108: 0.023
109: 0.027
110: 0.017
111: 0.019
112: 0.021
113: 0.025
114: 0.016
115: 0.032
116: 0.024
117: 0.020
118: 0.013
119: 0.013
120: 0.013
121: 0.018
122: 0.015
123: 0.021
124: 0.022
125: 0.015
126: 0.018
127: 0.016
128: 0.020
129: 0.013
130: 0.016
131: 0.013
132: 0.021
133: 0.013
134: 0.022
135: 0.014
136: 0.019
137: 0.013
138: 0.015
139: 0.010
140: 0.007
141: 0.018
142: 0.015
143: 0.011
144: 0.011
145: 0.013
146: 0.011
147: 0.009
148: 0.009
149: 0.012
150: 0.006
151: 0.011
152: 0.006
153: 0.014
154: 0.011
155: 0.008
156: 0.008
157: 0.011
158: 0.012
159: 0.005
160: 0.003
161: 0.008
162: 0.010
163: 0.008
164: 0.003
165: 0.010
166: 0.007
167: 0.006
168: 0.006
169: 0.010
170: 0.004
171: 0.006
172: 0.016
173: 0.014
174: 0.004
175: 0.010
176: 0.010
177: 0.004
178: 0.007
179: 0.009
180: 0.008
181: 0.009
182: 0.010
183: 0.002
184: 0.009
185: 0.002
186: 0.009
187: 0.005
188: 0.014
189: 0.004
190: 0.006
191: 0.004
192: 0.010
193: 0.004
194: 0.007
195: 0.008
196: 0.008
197: 0.003
198: 0.009
199: 0.004
200: 0.008
201: 0.001
202: 0.005
203: 0.009
204: 0.006
205: 0.006
206: 0.004
207: 0.007
208: 0.001
209: 0.003
210: 0.004
211: 0.002
212: 0.006
213: 0.007
214: 0.003
215: 0.007
216: 0.008
217: 0.008
218: 0.008
219: 0.006
220: 0.003
221: 0.004
222: 0.006
223: 0.002
224: 0.005
225: 0.008
226: 0.005
227: 0.005
228: 0.006
229: 0.005
230: 0.007
231: 0.006
232: 0.007
233: 0.008
234: 0.003
235: 0.002
236: 0.001
237: 0.007
238: 0.004
239: 0.003
240: 0.003
241: 0.004
242: 0.004
243: 0.005
244: 0.003
245: 0.006
246: 0.006
247: 0.002
248: 0.003
249: 0.004
250: 0.002
251: 0.005
252: 0.008
253: 0.003
254: 0.004
255: 0.003
256: 0.004
257: 0.008
258: 0.004
259: 0.007
260: 0.002
261: 0.002
262: 0.002
263: 0.001
264: 0.003
265: 0.001
266: 0.003
267: 0.003
268: 0.001
269: 0.003
270: 0.004
271: 0.002
272: 0.002
273: 0.002
274: 0.005
275: 0.002
276: 0.005
277: 0.002
278: 0.007
279: 0.002
281: 0.001
282: 0.007
283: 0.004
284: 0.001
285: 0.004
286: 0.001
287: 0.005
288: 0.001
289: 0.001
290: 0.001
292: 0.002
293: 0.002
294: 0.002
295: 0.001
296: 0.004
297: 0.003
298: 0.002
299: 0.001
300: 0.001
301: 0.003
302: 0.002
303: 0.001
304: 0.003
305: 0.002
306: 0.002
307: 0.002
308: 0.003
310: 0.003
311: 0.002
314: 0.001
315: 0.003
316: 0.001
317: 0.002
318: 0.001
319: 0.003
320: 0.002
321: 0.005
322: 0.002
323: 0.004
324: 0.001
325: 0.002
326: 0.003
327: 0.006
328: 0.004
329: 0.002
330: 0.002
331: 0.002
332: 0.001
333: 0.001
334: 0.003
335: 0.001
336: 0.003
337: 0.001
338: 0.001
339: 0.001
341: 0.002
343: 0.001
345: 0.003
346: 0.002
347: 0.001
348: 0.004
350: 0.001
352: 0.001
353: 0.003
354: 0.001
355: 0.002
357: 0.001
359: 0.001
361: 0.002
362: 0.001
364: 0.002
365: 0.001
366: 0.001
368: 0.003
369: 0.002
370: 0.002
371: 0.002
372: 0.002
373: 0.003
374: 0.001
376: 0.001
380: 0.001
381: 0.002
383: 0.001
386: 0.002
388: 0.001
389: 0.001
391: 0.003
393: 0.001
396: 0.002
399: 0.002
403: 0.001
404: 0.001
408: 0.001
410: 0.002
411: 0.001
412: 0.002
413: 0.001
417: 0.001
418: 0.001
419: 0.002
421: 0.001
427: 0.001
428: 0.003
429: 0.001
430: 0.003
431: 0.001
432: 0.001
433: 0.002
434: 0.001
438: 0.001
439: 0.002
442: 0.001
444: 0.001
445: 0.001
458: 0.002
460: 0.001
463: 0.001
464: 0.001
465: 0.001
467: 0.001
469: 0.002
470: 0.002
472: 0.001
473: 0.001
477: 0.002
489: 0.001
491: 0.002
493: 0.001
496: 0.001
497: 0.001
511: 0.001
516: 0.002
518: 0.001
526: 0.001
531: 0.001
533: 0.001
535: 0.001
536: 0.001
538: 0.001
540: 0.001
542: 0.002
544: 0.001
549: 0.002
551: 0.003
553: 0.001
554: 0.002
555: 0.001
559: 0.001
567: 0.001
570: 0.001
576: 0.001
578: 0.001
589: 0.001
591: 0.001
592: 0.001
601: 0.001
606: 0.001
610: 0.001
615: 0.001
618: 0.001
627: 0.002
628: 0.001
630: 0.001
678: 0.002
679: 0.001
682: 0.001
697: 0.001
698: 0.001
699: 0.001
720: 0.001
724: 0.001
725: 0.001
736: 0.001
738: 0.001
765: 0.001
781: 0.001
782: 0.001
803: 0.001
804: 0.001
809: 0.001
810: 0.001
823: 0.001
829: 0.001
834: 0.001
837: 0.001
869: 0.001
880: 0.001
899: 0.001
901: 0.001
912: 0.001
926: 0.001
927: 0.001
941: 0.001
981: 0.001
~: 67.181

--}
